<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- 
    specify variables:
    
    ${builddir} - where to build
    ${version}  - release version
    ${jambidir} - where qtjambi resides
    
    ! qt-jambi is platform-dependent, so 
    copy qtjambi-[version].jar and qtjambi-[platform]-[version].jar to ${jambidir}
    and rename them to qtjambi.jar and qtjambi-native.jar
 -->
<project default="create_run_jar" name="Create Runnable Jar for Project QJBookShelf">

	<property name="libdir" value="${basedir}/lib/" />
	<property name="targetdir" value="${builddir}/jbookshelf-${version}" />
	<property name="modeldir" value="${basedir}/../JBookShelfModel" />

	<target name="create_run_jar">
		<mkdir dir="${targetdir}"/>
		
		<jar destfile="${targetdir}/jbookshelf.jar" filesetmanifest="mergewithoutmain">
			<manifest>
				<attribute name="Built-By" value="${user.name}" />
				<attribute name="Main-Class" value="org.jbookshelf.qtgui.MainWindow" />
				<attribute name="Class-Path" value="." />
			</manifest>

			<zipfileset excludes="META-INF/*.SF" src="${jambidir}/qtjambi.jar" />
			<zipfileset excludes="META-INF/*.SF" src="${jambidir}/qtjambi-native.jar" />

			<!-- todo specify jars automatically -->
            <zipfileset excludes="META-INF/*.SF" src="${libdir}/junit.jar" />
            <zipfileset excludes="META-INF/*.SF" src="${libdir}/kernel.jar" />
            <zipfileset excludes="META-INF/*.SF" src="${libdir}/org.eclipse.emf.common_2.4.0.v200808251517.jar" />
            <zipfileset excludes="META-INF/*.SF" src="${libdir}/org.eclipse.emf.ecore_2.4.1.v200808251517.jar" />
            <zipfileset excludes="META-INF/*.SF" src="${libdir}/org.eclipse.emf.ecore.xmi_2.4.1.v200808251517.jar" />
            	
			<fileset dir="${basedir}/bin" />
			<fileset dir="${modeldir}/bin" />
		</jar>
		
		<copy todir="${targetdir}" overwrite="true">
			<fileset dir="${basedir}/../../build/">
				<exclude name=".svn"/>
			</fileset>
		</copy>
		
		<zip destfile="${targetdir}.zip">
			<fileset dir="${targetdir}"/>
		</zip>
	</target>

	<property name="srcdir" value="${basedir}/src/" />
	<property name="packagedir" value="org/jbookshelf/qtgui" />

	<target name="lupdate">
		<exec executable="${jambidir}/bin/lupdate">
			<!-- todo specify directories recusrively -->
			<arg value="${srcdir}/${packagedir}/*" />
			<arg value="-ts" />
			<arg value="${basedir}/translations/jbookshelf.ts" />
		</exec>
	</target>

	<target name="lrelease">
		<exec executable="${jambidir}/bin/lrelease">
			<arg value="${basedir}/translations/jbookshelf.ts" />
			<arg value="-qm" />
			<arg value="${basedir}/translations/jbookshelf.qm" />
		</exec>
	</target>

	<target name="translate" depends="lupdate, lrelease" />

</project>
